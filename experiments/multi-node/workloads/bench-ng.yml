---
- hosts: zlog-client
  tasks:
  - name: run el benchmark
    shell: >
           docker run --rm \
             --name=zlog-client \
             --net=host \
             -v /etc/ceph:/etc/ceph \
             piha.soe.ucsc.edu:5000/zlog/client:jewel \
             "/src/zlog/src/zlog-bench-ng --pool cephfs_data --server issdm-45 --port 5678 --iosize 512 --append true --qdepth {{ item }} --width 320 --runtime 120"
    register: results
    with_items:
      - 1
      - 2
      - 3
      - 4

  - name: parse results
    connection: local
    template: src=parse.j2 dest=results/bench-ng-depth.csv
    with_items:
      - "{{ results.results }}"
